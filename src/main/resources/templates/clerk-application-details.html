<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Application Details | Clerk</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background:#f4f6f9; font-family:'Segoe UI'; }
        .navbar-custom { background:linear-gradient(90deg,#1e3a8a,#2563eb); color:white; padding:12px 25px; }
        .card { border-radius:12px; border:none; box-shadow:0 6px 18px rgba(0,0,0,0.08); }
        .card-header { background:white; border-bottom:1px solid #e5e7eb; font-weight:600; }
        .badge-status { padding:6px 12px; border-radius:6px; font-size:13px; }
        footer { background:#1f2937; color:white; text-align:center; padding:12px; margin-top:40px; }
    </style>
</head>
<body>

<div class="navbar-custom d-flex justify-content-between align-items-center">
    <div><b>SClerk Panel</b></div>
    <div>
        <a th:href="@{/clerk/dashboard}" class="btn btn-light btn-sm me-2">Dashboard</a>
        <a th:href="@{/logout}" class="btn btn-danger btn-sm">Logout</a>
    </div>
</div>

<div class="container my-4">

    <!-- ================= Application Info ================= -->
    <div class="card mb-4">
        <div class="card-header">Application Information</div>
        <div class="card-body row g-3">

            <div class="col-md-6"><b>Application ID:</b> <span th:text="${app.applicationId}"></span></div>

            <div class="col-md-6">
                <b>Status:</b>
                <span class="badge-status bg-warning text-dark" th:if="${app.status=='SUBMITTED'}">SUBMITTED</span>
                <span class="badge-status bg-info text-dark" th:if="${app.status=='VERIFIED'}">VERIFIED</span>
                <span class="badge-status bg-success" th:if="${app.status=='APPROVED'}">APPROVED</span>
                <span class="badge-status bg-danger" th:if="${app.status=='REJECTED_BY_CLERK'}">REJECTED BY CLERK</span>
                <span class="badge-status bg-danger" th:if="${app.status=='REJECTED_BY_OFFICER'}">REJECTED BY OFFICER</span>
            </div>

            <div class="col-md-6"><b>Service Type:</b> <span th:text="${app.serviceType}"></span></div>
            <div class="col-md-6"><b>Date:</b> <span th:text="${#temporals.format(app.applicationDate,'dd-MM-yyyy')}"></span></div>

            <div class="col-12"><b>Purpose:</b> <span th:text="${app.purpose}"></span></div>
            <div class="col-12"><b>Address:</b> <span th:text="${app.address}"></span></div>
        </div>
    </div>

    <!-- ================= Citizen Info ================= -->
    <div class="card mb-4">
        <div class="card-header">Citizen Details</div>
        <div class="card-body row g-3">
            <div class="col-md-4"><b>Name:</b><br><span th:text="${app.citizen?.name}"></span></div>
            <div class="col-md-4"><b>Email:</b><br><span th:text="${app.citizen?.email}"></span></div>
            <div class="col-md-4"><b>Mobile:</b><br><span th:text="${app.citizen?.mobile}"></span></div>
        </div>
    </div>

    <!-- ================= Documents ================= -->
    <div class="card mb-4">
        <div class="card-header">Uploaded Documents</div>
        <div class="card-body table-responsive">
            <table class="table table-hover align-middle text-center">
                <thead class="table-light">
                <tr><th>Name</th><th>Type</th><th>Action</th></tr>
                </thead>
                <tbody>
                <tr th:each="doc : ${documents}">
                    <td th:text="${doc.documentName}"></td>
                    <td th:text="${doc.documentType}"></td>
                    <td>
                        <a th:href="@{/documents/view/{id}(id=${doc.documentId})}"
                           class="btn btn-outline-primary btn-sm" target="_blank">View</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ================= Rejection Info (Show if rejected) ================= -->
    <div class="card mb-4" th:if="${app.status.startsWith('REJECTED')}">
        <div class="card-header text-danger">Rejection Details</div>
        <div class="card-body">
            <p><b>Rejected By:</b> <span th:text="${app.rejectedBy}"></span></p>
            <p><b>Reason:</b></p>
            <div class="alert alert-danger" th:text="${app.rejectionReason}"></div>
        </div>
    </div>

    <!-- ================= Clerk Actions ================= -->
    <div class="card" th:if="${app.status == 'SUBMITTED'}">
        <div class="card-header">Clerk Decision</div>
        <div class="card-body">

            <!-- VERIFY -->
            <form th:action="@{/clerk/verify/{id}(id=${app.applicationId})}" method="post" class="mb-3 text-center">
                <button class="btn btn-success px-4">✔ Verify & Forward</button>
            </form>

            <!-- REJECT WITH REASON -->
            <form th:action="@{/clerk/reject/{id}(id=${app.applicationId})}" method="post">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Rejection Reason</label>
                    <textarea name="reason" class="form-control" rows="3" required></textarea>
                </div>
                <button class="btn btn-danger px-4">✖ Reject Application</button>
            </form>

        </div>
    </div>

</div>

<footer>© 2026 Citizen Service Portal | Clerk Module</footer>
</body>
</html>
