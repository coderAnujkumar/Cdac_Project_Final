<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Application Review | Officer</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background:#eef2f7; font-family:'Segoe UI'; }
        .navbar-custom { background:linear-gradient(90deg,#0f172a,#1e293b); }
        .card { border-radius:14px; border:none; box-shadow:0 8px 20px rgba(0,0,0,0.08); }
        .card-header { background:#1e293b; color:white; font-size:20px; font-weight:600; text-align:center; }
        .section-title { font-weight:600; color:#1e293b; margin-top:15px; margin-bottom:10px; border-bottom:2px solid #e2e8f0; padding-bottom:5px; }
        .label-title { font-weight:600; color:#475569; }
        .value-text { color:#0f172a; }
        .action-box { background:#f8fafc; border-radius:10px; padding:20px; margin-top:20px; text-align:center; }
        footer { padding:15px; background:#0f172a; color:white; text-align:center; }
    </style>
</head>

<body class="d-flex flex-column min-vh-100">

<nav class="navbar navbar-dark navbar-custom px-4">
    <span class="navbar-brand fw-bold">CSP Officer Panel</span>
    <a th:href="@{/officer/dashboard}" class="btn btn-light btn-sm">Dashboard</a>
</nav>

<div class="container my-5 flex-grow-1">

    <div class="card mx-auto" style="max-width: 850px;">
        <div class="card-header">Application Review & Final Approval</div>

        <div class="card-body px-4">

            <!-- Application Info -->
            <div class="section-title">Application Information</div>

            <div class="row mb-2">
                <div class="col-md-4 label-title">Application ID</div>
                <div class="col-md-8 value-text" th:text="${app.applicationId}"></div>
            </div>

            <div class="row mb-2">
                <div class="col-md-4 label-title">Service Type</div>
                <div class="col-md-8 value-text" th:text="${app.serviceType}"></div>
            </div>

            <div class="row mb-2">
                <div class="col-md-4 label-title">Current Status</div>
                <div class="col-md-8">
                    <span class="badge bg-info text-dark" th:text="${app.status}"></span>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-4 label-title">Submitted Date</div>
                <div class="col-md-8 value-text" th:text="${#temporals.format(app.applicationDate,'dd-MM-yyyy')}"></div>
            </div>

            <!-- Citizen Info -->
            <div class="section-title">Citizen Details</div>

            <div class="row mb-2">
                <div class="col-md-4 label-title">Name</div>
                <div class="col-md-8 value-text" th:text="${app.citizen.name}"></div>
            </div>

            <div class="row mb-2">
                <div class="col-md-4 label-title">Email</div>
                <div class="col-md-8 value-text" th:text="${app.citizen.email}"></div>
            </div>

            <div class="row mb-2">
                <div class="col-md-4 label-title">Phone</div>
                <div class="col-md-8 value-text" th:text="${app.citizen.mobile}"></div>
            </div>

            <div class="row mb-3">
                <div class="col-md-4 label-title">Address</div>
                <div class="col-md-8 value-text" th:text="${app.address}"></div>
            </div>

            <!-- Previous Rejection Info -->
            <div class="card mb-3 border-danger" th:if="${app.status.startsWith('REJECTED')}">
                <div class="card-header bg-danger text-white">Rejection Details</div>
                <div class="card-body">
                    <p><b>Rejected By:</b> <span th:text="${app.rejectedBy}"></span></p>
                    <p><b>Reason:</b></p>
                    <div class="alert alert-danger" th:text="${app.rejectionReason}"></div>
                </div>
            </div>

            <!-- Officer Action Panel -->
            <div class="action-box" th:if="${app.status == 'VERIFIED'}">
                <h5 class="mb-3">Final Decision</h5>

                <!-- APPROVE -->
                <form th:action="@{/officer/approve/{id}(id=${app.applicationId})}"
                      method="post" class="mb-3">
                    <button class="btn btn-success btn-lg px-4">
                        Approve & Issue Certificate
                    </button>
                </form>

                <!-- REJECT WITH REASON -->
                <form th:action="@{/officer/reject/{id}(id=${app.applicationId})}"
                      method="post">
                    <div class="mb-3 text-start">
                        <label class="form-label fw-semibold">Rejection Reason</label>
                        <textarea name="reason" class="form-control" rows="3" required></textarea>
                    </div>
                    <button class="btn btn-danger btn-lg px-4">
                        Reject Application
                    </button>
                </form>
            </div>

            <!-- Back -->
            <div class="text-center mt-4">
                <a th:href="@{/officer/dashboard}" class="btn btn-outline-secondary">
                    ← Back to Dashboard
                </a>
            </div>

        </div>
    </div>
</div>

<footer class="mt-auto">
    © 2026 Citizen Service Portal | Officer Authority Module
</footer>

</body>
</html>
